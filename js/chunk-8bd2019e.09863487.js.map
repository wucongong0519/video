{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es6.string.repeat.js","webpack:///./node_modules/core-js/modules/_string-repeat.js","webpack:///./src/pages/login/index.vue?72df","webpack:///src/pages/login/index.vue","webpack:///./src/pages/login/index.vue?1da1","webpack:///./src/pages/login/index.vue?9be2","webpack:///./src/pages/login/index.vue?6d83"],"names":["$export","__webpack_require__","P","repeat","toInteger","defined","module","exports","count","str","String","this","res","n","Infinity","RangeError","render","_vm","_h","$createElement","_c","_self","staticClass","_m","_v","attrs","align","ref","id","hidden","width","height","_e","staticStyle","margin","style","directives","name","rawName","value","expression","type","tabindex","auto-complete","placeholder","domProps","on","input","$event","target","composing","username","margin-top","padding","showVideo","isRegister","click","login","register","closeCamera","startFace","registerView","_s","dialogMsg","href","closeDialog","staticRenderFns","loginvue_type_script_lang_js_","data","loading","redirect","undefined","showProgress","imgDatas","progress","mediaStreamTrack","panel_loading","showDilog","watch","$route","handler","route","query","immediate","methods","getUserMedia","constraints","success","error","navigator","mediaDevices","msg","then","catch","webkitGetUserMedia","mozGetUserMedia","stream","video_buffer","window","URL","webkitURL","$refs","video","srcObject","play","_error","console","concat","message","log","getTracks","stop","that","timer","setInterval","getPic","clearInterval","headRegister","_this","Object","user","imgData","facingMode","canvas","context","getContext","drawImage","toDataURL","push","handleLogin","_this2","$store","dispatch","getters","token","$router","path","pages_loginvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_index_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default"],"mappings":"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","file":"js/chunk-8bd2019e.09863487.js","sourcesContent":["var $export = require('./_export');\n\n$export($export.P, 'String', {\n  // 21.1.3.13 String.prototype.repeat(count)\n  repeat: require('./_string-repeat')\n});\n","'use strict';\nvar toInteger = require('./_to-integer');\nvar defined = require('./_defined');\n\nmodule.exports = function repeat(count) {\n  var str = String(defined(this));\n  var res = '';\n  var n = toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page\"},[_vm._m(0),_c('div',{staticClass:\"page__bd\"},[_c('div',[_c('div',{staticClass:\"weui-toptips weui-toptips_warn js_tooltips\"},[_vm._v(\"错误提示\")]),(_vm.showVideo)?_c('div',{attrs:{\"align\":\"center\"}},[_c('video',{ref:\"video\",staticClass:\"video_class\",attrs:{\"id\":\"video\"}}),_c('canvas',{ref:\"canvas\",attrs:{\"hidden\":\"true\",\"id\":\"canvas\",\"width\":\"200\",\"height\":\"200\"}})]):_vm._e(),(_vm.showProgress)?_c('div',{staticClass:\"weui-progress\",staticStyle:{\"margin\":\"10px\"}},[_c('div',{staticClass:\"weui-progress__bar\"},[_c('div',{staticClass:\"weui-progress__inner-bar js_progress\",style:(_vm.progress)})])]):_vm._e(),(_vm.isRegister)?_c('div',{staticClass:\"weui-cells\"},[_c('div',{staticClass:\"weui-cell\"},[_c('div',{staticClass:\"weui-cell__bd\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.username),expression:\"username\"}],ref:\"username\",staticClass:\"weui-input\",attrs:{\"name\":\"username\",\"type\":\"text\",\"tabindex\":\"1\",\"auto-complete\":\"on\",\"placeholder\":\"输入注册名称\"},domProps:{\"value\":(_vm.username)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.username=$event.target.value}}})])])]):_vm._e(),_c('div',{staticStyle:{\"margin-top\":\"20px\",\"padding\":\"10px\"}},[(_vm.showVideo&&!_vm.isRegister)?_c('a',{staticClass:\"weui-btn weui-btn_primary\",on:{\"click\":_vm.login}},[_vm._v(\"验证\")]):_vm._e(),(_vm.isRegister)?_c('a',{staticClass:\"weui-btn weui-btn_primary\",on:{\"click\":_vm.register}},[_vm._v(\"注册\")]):_vm._e(),(_vm.showVideo)?_c('a',{staticClass:\"weui-btn weui-btn_primary\",on:{\"click\":_vm.closeCamera}},[_vm._v(\"关闭视频\")]):_vm._e()]),_c('div',{staticClass:\"weui-flex\"},[_c('div',{staticClass:\"weui-flex__item\"},[_c('div',{staticClass:\"placeholder\",staticStyle:{\"padding\":\"5px\"}},[(!_vm.showVideo)?_c('a',{staticClass:\"weui-btn weui-btn_primary\",on:{\"click\":_vm.startFace}},[_vm._v(\"人脸识别\")]):_vm._e()])]),_c('div',{staticClass:\"weui-flex__item\"},[_c('div',{staticClass:\"placeholder\",staticStyle:{\"padding\":\"5px\"}},[(!_vm.showVideo)?_c('a',{staticClass:\"weui-btn weui-btn_primary\",on:{\"click\":_vm.registerView}},[_vm._v(\"人脸注册\")]):_vm._e()])])])])]),(_vm.loading)?_c('div',{attrs:{\"id\":\"loadingToast\"}},[_c('div',{staticClass:\"weui-mask_transparent mask\"}),_vm._m(1)]):_vm._e(),(_vm.showDilog)?_c('div',{staticClass:\"js_dialog\",attrs:{\"id\":\"iosDialog2\"}},[_c('div',{staticClass:\"weui-mask\"}),_c('div',{staticClass:\"weui-dialog\"},[_c('div',{staticClass:\"weui-dialog__bd\"},[_vm._v(_vm._s(_vm.dialogMsg))]),_c('div',{staticClass:\"weui-dialog__ft\"},[_c('a',{staticClass:\"weui-dialog__btn weui-dialog__btn_primary\",attrs:{\"href\":\"javascript:;\"},on:{\"click\":_vm.closeDialog}},[_vm._v(\"知道了\")])])])]):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"page__hd\"},[_c('h1',{staticClass:\"page__title\"},[_vm._v(\"人脸识别系统\")]),_c('p',{staticClass:\"page__desc\"},[_vm._v(\"v1.0.0\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"weui-toast\"},[_c('i',{staticClass:\"weui-loading weui-icon_toast\"}),_c('p',{staticClass:\"weui-toast__content\"},[_vm._v(\"数据加载中\")])])}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"page\">\r\n    <div class=\"page__hd\">\r\n      <h1 class=\"page__title\">人脸识别系统</h1>\r\n      <p class=\"page__desc\">v1.0.0</p>\r\n    </div>\r\n    <div class=\"page__bd\">\r\n      <div>\r\n        <div class=\"weui-toptips weui-toptips_warn js_tooltips\">错误提示</div>\r\n        <!--人脸识别start-->\r\n        <div v-if=\"showVideo\" align=\"center\">\r\n          <video class=\"video_class\" id=\"video\" ref=\"video\"></video>\r\n          <canvas hidden=\"true\" id=\"canvas\" width=\"200\" height=\"200\" ref=\"canvas\"></canvas>\r\n        </div>\r\n        <div v-if=\"showProgress\" class=\"weui-progress\" style=\"margin:10px\">\r\n          <div class=\"weui-progress__bar\">\r\n            <div class=\"weui-progress__inner-bar js_progress\" :style=\"progress\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"weui-cells\" v-if=\"isRegister\">\r\n          <div class=\"weui-cell\">\r\n            <div class=\"weui-cell__bd\">\r\n              <input\r\n                class=\"weui-input\"\r\n                ref=\"username\"\r\n                v-model=\"username\"\r\n                name=\"username\"\r\n                type=\"text\"\r\n                tabindex=\"1\"\r\n                auto-complete=\"on\"\r\n                placeholder=\"输入注册名称\"\r\n              >\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div style=\"margin-top:20px;padding:10px\">\r\n          <a v-if=\"showVideo&&!isRegister\" class=\"weui-btn weui-btn_primary\" v-on:click=\"login\">验证</a>\r\n          <a v-if=\"isRegister\" class=\"weui-btn weui-btn_primary\" v-on:click=\"register\">注册</a>\r\n          <a class=\"weui-btn weui-btn_primary\" v-if=\"showVideo\" v-on:click=\"closeCamera\">关闭视频</a>\r\n        </div>\r\n        <div class=\"weui-flex\">\r\n          <div class=\"weui-flex__item\">\r\n            <div class=\"placeholder\" style=\"padding:5px\">\r\n              <a v-if=\"!showVideo\" class=\"weui-btn weui-btn_primary\" v-on:click=\"startFace\">人脸识别</a>\r\n            </div>\r\n          </div>\r\n          <div class=\"weui-flex__item\">\r\n            <div class=\"placeholder\" style=\"padding:5px\">\r\n              <a v-if=\"!showVideo\" class=\"weui-btn weui-btn_primary\" v-on:click=\"registerView\">人脸注册</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div id=\"loadingToast\" class v-if=\"loading\">\r\n      <div class=\"weui-mask_transparent mask\"></div>\r\n      <div class=\"weui-toast\">\r\n        <i class=\"weui-loading weui-icon_toast\"></i>\r\n        <p class=\"weui-toast__content\">数据加载中</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!--BEGIN dialog2-->\r\n    <div class=\"js_dialog\" id=\"iosDialog2\" v-if=\"showDilog\">\r\n      <div class=\"weui-mask\"></div>\r\n      <div class=\"weui-dialog\">\r\n        <div class=\"weui-dialog__bd\">{{dialogMsg}}</div>\r\n        <div class=\"weui-dialog__ft\">\r\n          <a\r\n            href=\"javascript:;\"\r\n            class=\"weui-dialog__btn weui-dialog__btn_primary\"\r\n            v-on:click=\"closeDialog\"\r\n          >知道了</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { registerFace } from \"@/api/user\";\r\nexport default {\r\n  name: \"Login\",\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      redirect: undefined,\r\n      showVideo: false,\r\n      showProgress: false,\r\n      imgDatas: [],\r\n      repeat: 0,\r\n      progress: \"\",\r\n      mediaStreamTrack: null,\r\n      isRegister: false,\r\n      username: \"\",\r\n      panel_loading: false,\r\n      dialogMsg: \"\",\r\n      showDilog: false\r\n    };\r\n  },\r\n  watch: {\r\n    $route: {\r\n      handler: function(route) {\r\n        this.redirect = route.query && route.query.redirect;\r\n      },\r\n      immediate: true\r\n    }\r\n  },\r\n  methods: {\r\n    //访问用户媒体设备的兼容方法\r\n    getUserMedia: function(constraints, success, error) {\r\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n        this.msg = \"1\";\r\n        //最新的标准API\r\n        navigator.mediaDevices\r\n          .getUserMedia(constraints)\r\n          .then(success)\r\n          .catch(error);\r\n      } else if (navigator.webkitGetUserMedia) {\r\n        this.msg = \"2\";\r\n        //webkit核心浏览器\r\n        navigator.webkitGetUserMedia(constraints, success, error);\r\n      } else if (navigator.mozGetUserMedia) {\r\n        this.msg = \"3\";\r\n        //firfox浏览器\r\n        navigator.mozGetUserMedia(constraints, success, error);\r\n      } else if (navigator.getUserMedia) {\r\n        this.msg = \"4\";\r\n        //旧版API\r\n        navigator.getUserMedia(constraints, success, error);\r\n      }\r\n    },\r\n    success: function(stream) {\r\n      this.video_buffer = stream;\r\n      //兼容webkit核心浏览器\r\n      let CompatibleURL = window.URL || window.webkitURL;\r\n      //将视频流设置为video元素的源\r\n      // this.$refs.video.src = CompatibleURL.createObjectURL(stream);\r\n      this.$refs.video.srcObject = stream;\r\n      this.$refs.video.play();\r\n      this.loading = false;\r\n    },\r\n    error: function(error) {\r\n      this.loading = false;\r\n      console.error(`访问用户媒体设备失败${error.name}, ${error.message}`);\r\n      this.showDilog = true;\r\n      this.dialogMsg = \"访问用户媒体设备失败\";\r\n    },\r\n    closeCamera: function() {\r\n      if (this.video_buffer) {\r\n        console.log(this.video_buffer.getTracks());\r\n        if (this.showProgress) {\r\n          return;\r\n        }\r\n        this.isRegister = false;\r\n        this.showVideo = false;\r\n        this.video_buffer && this.video_buffer.getTracks()[0].stop(); //关闭摄像头\r\n      }\r\n    },\r\n    registerView() {\r\n      this.isRegister = true;\r\n      this.startFace();\r\n    },\r\n    register() {\r\n      var that = this;\r\n      if (this.showProgress) {\r\n        return;\r\n      }\r\n      if (!this.username) {\r\n        that.showDilog = true;\r\n        that.dialogMsg = \"用户名不能为空，请输入用户名。\";\r\n        return;\r\n      }\r\n      that.showProgress = true;\r\n      that.imgDatas = [];\r\n      that.repeat = 0;\r\n      that.progress = \"width: 0%;\";\r\n      var timer = setInterval(function() {\r\n        that.getPic();\r\n        if (that.repeat == 5) {\r\n          clearInterval(timer);\r\n          that.headRegister();\r\n        }\r\n      }, 500);\r\n    },\r\n    headRegister() {\r\n      var that = this;\r\n      this.loading = true;\r\n\r\n      registerFace({\r\n        imgData: this.imgDatas,\r\n        username: this.username\r\n      })\r\n        .then(res => {\r\n          if (!res.success) {\r\n            that.showDilog = true;\r\n            that.dialogMsg = res.msg;\r\n          }\r\n          this.loading = false;\r\n          this.showProgress = false;\r\n          this.isRegister = false;\r\n        })\r\n        .catch(() => {\r\n          this.loading = false;\r\n          this.showProgress = false;\r\n        });\r\n    },\r\n    startFace() {\r\n      var that = this;\r\n      console.log(navigator.mediaDevices);\r\n      console.log(navigator.getUserMedia);\r\n      console.log(navigator.webkitGetUserMedia);\r\n      console.log(navigator.mozGetUserMedia);\r\n      if (\r\n        (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) ||\r\n        navigator.getUserMedia ||\r\n        navigator.webkitGetUserMedia ||\r\n        navigator.mozGetUserMedia\r\n      ) {\r\n        this.loading = true;\r\n        //调用用户媒体设备, 访问摄像头\r\n        that.getUserMedia(\r\n          {\r\n            video: { width: 300, height: 300, facingMode: \"user\" } //调用前置摄像头，后置摄像头使用video: { facingMode: { exact: \"environment\" } }\r\n          },\r\n          that.success,\r\n          that.error\r\n        );\r\n      } else {\r\n        this.loading = false;\r\n        console.error(\"不支持访问用户媒体\");\r\n        this.showDilog = true;\r\n        this.dialogMsg = \"不支持访问用户媒体\";\r\n      }\r\n      that.showVideo = true;\r\n    },\r\n    getPic() {\r\n      var that = this;\r\n      that.repeat++;\r\n      that.progress = \"width: \" + that.repeat * 20 + \"%;\";\r\n      let canvas = that.$refs.canvas;\r\n      let context = canvas.getContext(\"2d\");\r\n      canvas.width = 300;\r\n      canvas.height = 300;\r\n      context.drawImage(that.$refs.video, 0, 0, 300, 300);\r\n      var imgData = canvas.toDataURL();\r\n      that.imgDatas.push(imgData);\r\n    },\r\n    login() {\r\n      var that = this;\r\n      if (this.showProgress) {\r\n        return;\r\n      }\r\n      that.showProgress = true;\r\n      that.imgDatas = [];\r\n      that.repeat = 0;\r\n      that.progress = \"width: 0%;\";\r\n      var timer = setInterval(function() {\r\n        that.getPic();\r\n        if (that.repeat == 5) {\r\n          clearInterval(timer);\r\n          that.handleLogin();\r\n        }\r\n      }, 500);\r\n    },\r\n    handleLogin() {\r\n      var that = this;\r\n      this.loading = true;\r\n      this.$store\r\n        .dispatch(\"user/facelogin\", {\r\n          imgData: this.imgDatas\r\n        })\r\n        .then(() => {\r\n          console.log(this.$store.getters.token);\r\n          this.showProgress = false;\r\n          that.closeCamera();\r\n          if (this.$store.getters.token) {\r\n            this.$router.push({ path: this.redirect || \"/\" });\r\n          } else {\r\n            that.showDilog = true;\r\n            that.dialogMsg = \"验证失败，请重试！\";\r\n          }\r\n          this.loading = false;\r\n        })\r\n        .catch(() => {\r\n          that.closeCamera();\r\n          this.loading = false;\r\n          this.showProgress = false;\r\n        });\r\n    },\r\n    closeDialog() {\r\n      this.showDilog = false;\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style>\r\n.video_class {\r\n  border-radius: 50%;\r\n  width: 300;\r\n  height: 300;\r\n  border: 2px solid #e4007e;\r\n}\r\n\r\n.mask {\r\n  background: rgba(17, 17, 17, 0.7);\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=43d20977&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}